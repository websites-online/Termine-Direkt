<section class="section page">
  <div class="container">
    <div class="card admin-card">
      <div class="admin-header">
        <div>
          <h1 class="section-title">Admin Dashboard</h1>
          <p class="section-lead">Unternehmen verwalten und neue Seiten anlegen.</p>
        </div>
        <div class="admin-actions">
          <button class="btn btn-outline" type="button" (click)="logout()">Logout</button>
          <a class="btn btn-outline" routerLink="/">Zur Startseite</a>
        </div>
      </div>
    </div>

    <div class="card admin-card admin-form-card">
      <div class="admin-card-header">
        <h2>{{ editingSlug ? 'Unternehmen bearbeiten' : 'Neues Unternehmen' }}</h2>
      </div>
      <form class="admin-form" [formGroup]="companyForm" (ngSubmit)="submitCompany()">
        <label>
          <span class="label">Name*</span>
          <input class="input" type="text" formControlName="name" placeholder="Max Grill" />
        </label>
        <label>
          <span class="label">Betriebsart*</span>
          <select class="input" formControlName="serviceType">
            <option value="restaurant">Restaurant</option>
            <option value="friseur">Friseur</option>
          </select>
        </label>
        <label>
          <span class="label">Adresse*</span>
          <input class="input" type="text" formControlName="address" placeholder="Musterstraße 12, 10115 Berlin" />
        </label>
        <label>
          <span class="label">Öffnungszeiten*</span>
          <input
            class="input"
            type="text"
            formControlName="hours"
            placeholder="Mi–So 11:30–14:00; Di–So 17:30–23:00"
          />
        </label>
        <label>
          <span class="label">Buchungen pro Zeitslot*</span>
          <select class="input" formControlName="slotCapacity">
            <option [value]="1">1</option>
            <option [value]="2">2</option>
            <option [value]="3">3</option>
          </select>
        </label>
        <label>
          <span class="label">Mittagspause (optional)</span>
          <input class="input" type="text" formControlName="breakHours" placeholder="13:00–16:00" />
        </label>
        <label>
          <span class="label">E-Mail*</span>
          <input class="input" type="email" formControlName="email" placeholder="kontakt@maxgrill.de" />
        </label>
        <label>
          <span class="label">Login PIN (Unternehmenslogin)</span>
          <div class="pin-row">
            <input class="input" type="text" formControlName="loginPin" placeholder="z. B. 834216" />
            <button class="btn btn-outline pin-generate" type="button" (click)="generateLoginPin()">
              Neu generieren
            </button>
          </div>
          <span class="helptext">Bitte notieren und an das Unternehmen senden.</span>
          <span class="helptext">Leer lassen, um den bisherigen PIN beizubehalten.</span>
        </label>
        <div class="admin-form-actions">
          <button class="btn btn-primary" type="submit">
            {{ editingSlug ? 'Änderungen speichern' : 'Unternehmen anlegen' }}
          </button>
          <button class="btn btn-outline" type="button" *ngIf="editingSlug" (click)="cancelEdit()">
            Abbrechen
          </button>
        </div>
      </form>
    </div>

    <div class="card admin-card admin-list-card">
      <h2>Unternehmen</h2>
      <p class="helptext" *ngIf="companies.length === 0">Noch keine Unternehmen angelegt..</p>
      <div class="company-list" *ngIf="companies.length > 0">
        <div class="company-row" *ngFor="let company of companies">
          <div class="company-main">
            <h3>
              {{ company.name }}
              <span class="company-tag" [class.company-tag--salon]="company.serviceType === 'friseur'">
                {{ company.serviceType === 'friseur' ? 'Friseur' : 'Restaurant' }}
              </span>
            </h3>
            <p class="muted">{{ company.address || '—' }}</p>
            <p class="muted">
              {{ company.hours || '—' }}
              <span *ngIf="company.breakHours"> · Pause: {{ company.breakHours }}</span>
            </p>
            <p class="muted">Slots pro Zeit: {{ company.slotCapacity || 3 }}</p>
            <p class="muted">Login: {{ company.slug }}</p>
            <a class="company-link" [routerLink]="['/', company.slug]">/{{ company.slug }}</a>
          </div>
          <div class="company-actions">
            <a class="btn btn-outline" [routerLink]="['/', company.slug]">Zur Seite</a>
            <button class="btn btn-outline" type="button" (click)="startEdit(company)">Bearbeiten</button>
            <button class="btn btn-outline danger" type="button" (click)="deleteCompany(company.slug)">
              Löschen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
